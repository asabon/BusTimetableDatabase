# BusTimetableDatabase

## 概要
* json 形式で作成した、神奈中バスの時刻表データベース。
* データは神奈中バスのウェブサイトから取得。(Webスクレイピング)
* GitHub Actions を使って定期的に更新する。

### データベースのバージョニングについて
本プロジェクトでは、データベースのフォーマット（スキーマ）を変更する際、利用するアプリとの互換性を維持するためにバージョン番号（`v1`, `v2`, `v3`...）を分けて管理している。
新しいバージョンを導入した際は、アプリ側の移行が完了するまで旧バージョンを並行して運用する方針をとっている。

現在は自作アプリの `v3` への移行が完全に完了したため、旧フォーマットである `v1` および `v2` 関連のデータ・スクリプトは削除済みである。

詳細な仕様については、以下を参照。
* [v3 仕様書](docs/v3/README.md)

## 高速化と負荷分散
本プロジェクトでは、サーバーへの負荷を抑えつつデータを効率的に更新するために以下の仕組みを導入している。
* **ETag/Last-Modified 活用**: 神奈中バスのウェブサイトからデータを取得する際、HTTP ヘッダーの ETag や Last-Modified を利用して変更がない場合はダウンロードをスキップする。
* **負荷分散プリキャッシュ**: GitHub Actions のキャッシュ機能を使い、全 1,500 路線を毎日 7 分の 1 ずつ日替わりで事前取得しておくことで、本番実行時のサーバー負荷を大幅に分散させている。

## 目的
* 自作のバスの時刻表を扱うアプリから利用することを主目的としている。
* その一方で、同じようなことを実現したい誰かの役に立てたら・・・という思いから公開。

## 注意点
* データは神奈中バスのウェブサイトから取得している。
* そのため、神奈中バスのウェブサイトの構造変更によりデータ取得ができなくなる可能性がある。
* データの正確性については保証しない。

## ディレクトリ構成

```text
+ .github/
  + workflows/              : GitHub Actions を使った CI/CD 用ワークフロー
  + copilot-instructions.md : Copilot カスタムインストラクション
+ ci/                       : GitHub Actions から参照される設定ファイル置き場
+ database/                 : データベースディレクトリ
  + kanachu/
    + v3/                   : v3 データベース
+ release/                  : リリースディレクトリ
+ script/                   : スクリプトディレクトリ
+ LICENSE                   : ライセンスファイル(MIT)
+ README.md                 : このファイル
```

### database

* 時刻表データが json 形式で格納されている。
* 詳細は、 docs/ 以下を参照。

### release

* database ディレクトリの時刻表データが zip 形式で圧縮した状態で格納されている。
* 詳細は、 docs/ 以下を参照。

## LICENSE

MIT License.
