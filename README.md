# BusTimetableDatabase

## 概要
* json 形式で作成した、神奈中バスの時刻表データベース。
* データは神奈中バスのウェブサイトから取得。(Webスクレイピング)
* GitHub Actions を使って定期的に更新する。

### データベースのバージョニングについて
本プロジェクトでは、データベースのフォーマット（スキーマ）を変更する際、利用するアプリとの互換性を維持するためにバージョン番号（`v1`, `v2`, `v3`...）を分けて管理している。
新しいバージョンを導入した際は、アプリ側の移行が完了するまで旧バージョンを並行して運用する方針をとっている。

現在は自作アプリの `v3` への移行が完全に完了したため、旧フォーマットである `v1` および `v2` 関連のデータ・スクリプトは削除済みである。

詳細な仕様については、以下を参照。
* [v3 仕様書](docs/v3/README.md)

## 高速化と負荷分散
本プロジェクトでは、サーバーへの負荷を抑えつつデータを効率的に更新するために以下の仕組みを導入している。
* **ETag/Last-Modified 活用**: 神奈中バスのウェブサイトからデータを取得する際、HTTP ヘッダーの ETag や Last-Modified を利用して変更がない場合はダウンロードをスキップする。
* **負荷分散プリキャッシュ**: GitHub Actions のキャッシュ機能を使い、全 1,500 路線を毎日 7 分の 1 ずつ日替わりで事前取得しておくことで、本番実行時のサーバー負荷を大幅に分散させている。

## 目的
* 自作のバスの時刻表を扱うアプリから利用することを主目的としている。
* その一方で、同じようなことを実現したい誰かの役に立てたら・・・という思いから公開。

## 注意点
* データは神奈中バスのウェブサイトから取得している。
* そのため、神奈中バスのウェブサイトの構造変更によりデータ取得ができなくなる可能性がある。
* データの正確性については保証しない。

## Antigravity との協調開発フロー
本プロジェクトでは、AI エージェント「Antigravity」と協力して開発を進めるためのワークフローを導入しています。GitHub Issue を中心とした開発サイクルにより、透明性と効率性の高い開発を実現しています。

### 基本的な流れ

1. **セッションの開始・再開**
    - **ユーザー**: `/init` (初期化) または `/resume` (前回の続きから再開) を実行する。
    - **Antigravity**: プロジェクトのルールを読み込み、`task.md` から現在の作業状態を復元する。
2. **相談と検討**
    - **ユーザー**: 実装したい機能のアイデアや、修正の相談をチャットで送る。
    - **Antigravity**: 実装の方針、影響範囲、実現可能性を検討し、ユーザーと合意形成を行う。
3. **新規 Issue 起票**
    - **ユーザー**: 方針が決まったら、`/create-issue` を実行する。
    - **Antigravity**: 合意した内容を整理し、Issue 草案を作成して GitHub に起票する。
4. **作業の開始と実装**
    - **ユーザー**: `/start` を実行して作業を開始する。
    - **Antigravity**: 基本ルールや Issue 連携のチェックを行い、実装に着手する。作業の進捗に合わせて `task.md` を適宜更新する。
5. **コミット**
    - **ユーザー**: すべてのタスクが完了したことを確認し、`/commit` を実行する。
    - **Antigravity**: `task.md` の完了状態と変更内容を分析してコミットメッセージを生成する。ユーザーの承認を得てから、自動コミットを実行する。
6. **PR 作成とマージ**
    - **ユーザー**: コミットされたブランチを `git push` し、`/create-pr` を実行する。
    - **Antigravity**: GitHub 上で PR を起票する。
    - **ユーザー**: PR をレビューし、マージを実行する。

### 補足：任意タイミングの操作
- **進捗の保存 (`/save`)**
    - **いつ**: 作業の区切りや、セッションを途中で中断したい時。
    - **内容**: 実行すると `task.md` に現在の状況が詳細に記録され、作業状態が正確に保存されます。次回 `/resume` でここから再開できます。

### メリット
- **文脈の確実な引き継ぎ**: `/save` & `/resume` により、作業の再開がスムーズです。
- **事務作業の自動化**: コミットメッセージ生成や PR 作成を AI が代行します。
- **透明性の確保**: 進捗は常に `docs/progress/task.md` で管理されます。

## ディレクトリ構成

```text
+ .github/
  + workflows/              : GitHub Actions を使った CI/CD 用ワークフロー
  + copilot-instructions.md : Copilot カスタムインストラクション
+ ci/                       : GitHub Actions から参照される設定ファイル置き場
+ database/                 : データベースディレクトリ
  + kanachu/
    + v3/                   : v3 データベース
+ release/                  : リリースディレクトリ
+ script/                   : スクリプトディレクトリ
+ LICENSE                   : ライセンスファイル(MIT)
+ README.md                 : このファイル
```

### database

* 時刻表データが json 形式で格納されている。
* 詳細は、 docs/ 以下を参照。

### release

* database ディレクトリの時刻表データが zip 形式で圧縮した状態で格納されている。
* 詳細は、 docs/ 以下を参照。

## LICENSE

MIT License.
