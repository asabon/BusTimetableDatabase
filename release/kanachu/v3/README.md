# Kanachu Bus Timetable Database V3 Release

このディレクトリには、神奈中バス時刻表データベース V3 のリリースアーティファクトが含まれます。

## リリースディレクトリ構成

本ディレクトリ (`release/kanachu/v3`) の構成は以下の通りです。

```text
release/kanachu/v3/
├── README.md        <-- 本ファイル
├── info.json        <-- メタデータ (ハッシュ値、更新日時、路線一覧)
├── busstops.json    <-- 全バス停のマスタデータ
└── {route_id}.zip   <-- 路線別データ (多数存在)
```

### info.json の内容

`info.json` には、データセット全体のメタデータと、各路線の更新情報が含まれます。
アプリはこれを参照して、必要な路線データのみをダウンロード・更新することができます。

詳細なフォーマットについては、[docs/v3/README.md](../../../docs/v3/README.md) を参照してください。

## 提供されるファイル

### 路線別データ (`{route_id}.zip`)
特定の路線のみが必要なアプリ開発者向けに、路線ごとの個別zipファイルを提供します。
必要な路線だけをダウンロードすることで、通信量とストレージを節約できます。

## ディレクトリ構成

すべてのzipファイルは、展開すると `database` というルートディレクトリの下に配置されるように構成されています。
`busstops.json` はそのまま `database` ディレクトリ直下に配置してください。

### 構築後のディレクトリ構造例

アプリ側では、以下のようなディレクトリ構成でデータを管理することを想定しています。
`info.json` を起点に、必要なファイルのみをダウンロード・更新します。

```text
.
└── database/
    ├── info.json              <-- メタデータ (更新判定用)
    ├── busstops.json          <-- 全バス停マスタ
    ├── {route_id_A}/          <-- 路線Aのデータ
    │   ├── route.json
    │   ├── 01.json
    │   └── ...
    ├── {route_id_B}/          <-- 路線Bのデータ
    │   ├── route.json
    │   └── ...
    └── ...
```

### 更新フローのイメージ

1. アプリ起動時などに、サーバー上の最新の `info.json` を取得します。
2. ローカルの `info.json` (存在する場合) と比較します。
   - `updated_at` が新しい場合、更新処理を開始します。
3. `busstops` のハッシュ値を比較し、異なれば `busstops.json` をダウンロードして更新します。
4. 必要な路線 (ユーザーが登録している路線など) について、`routes` リスト内のハッシュ値を比較します。
   - ハッシュ値が異なる場合、その路線の `{route_id}.zip` をダウンロードし、展開して上書き更新します。
5. 更新完了後、ローカルの `info.json` を最新のものに置き換えます。

### ファイルフォーマット詳細

各ファイルのデータ構造やフィールドの詳細については、[docs/v3/README.md](../../../docs/v3/README.md) を参照してください。

## アプリ開発者への推奨事項

- **部分更新**: アプリ側で必要な路線が予め決まっている場合、`{route_id}.zip` を個別にダウンロードして展開することを推奨します。
- **データ統合**: 複数の個別データを同じディレクトリに展開することで、データを統合できます。
